<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="YT7QzoP0CGYZziDQuLr2aOTGGmpgioKi3izg5T1vBPs" />














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="yongfeiuall,唐胡璐,软件测试,自动化测试,性能测试,Software Testing,QTP,Selenium,Performance Testing" />





  <link rel="alternate" href="/atom.xml" title="YONGFEIUALL" type="application/atom+xml" />






<meta name="description" content="i just wanna live while i am alive">
<meta property="og:type" content="website">
<meta property="og:title" content="YONGFEIUALL">
<meta property="og:url" content="http://izheyi.com/page/10/index.html">
<meta property="og:site_name" content="YONGFEIUALL">
<meta property="og:description" content="i just wanna live while i am alive">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="YONGFEIUALL">
<meta name="twitter:description" content="i just wanna live while i am alive">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://izheyi.com/page/10/"/>





  <title>YONGFEIUALL</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?964433a58390bc50ac82f1418eb8dc8e";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">YONGFEIUALL</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">izheyi.com</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="st-search-show-outputs">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <form class="site-search-form">
  <input type="text" id="st-search-input" class="st-search-input st-default-search-input" />
</form>

<script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
    (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
    e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

  _st('install', 'fZPEsEHs3tafejXBDpZs','2.0.0');
</script>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://izheyi.com/2018/08/11/Dubbo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐胡璐">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YONGFEIUALL">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/11/Dubbo/" itemprop="url">Dubbo</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-11T14:30:11+08:00">
                2018-08-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Distribution/" itemprop="url" rel="index">
                    <span itemprop="name">Distribution</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/11/Dubbo/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2018/08/11/Dubbo/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://dubbo.incubator.apache.org" target="_blank" rel="external">Dubbo</a>是一款分布式服务框架，高性能和透明化的RPC远程服务调用方案。</p>
<p>Dubbo采用全spring配置方式，透明化接入应用，对应用没有任何API侵入，只需用Spring加载Dubbo的配置即可。</p>
<h1 id="Dubbo架构："><a href="#Dubbo架构：" class="headerlink" title="Dubbo架构："></a>Dubbo架构：</h1><p><img src="/images/distributed/dubbo_frame.jpg" alt=""></p>
<ul>
<li>Provider: 暴露服务的服务提供方。 </li>
<li>Consumer: 调用远程服务的服务消费方。 </li>
<li>Registry: 服务注册与发现的注册中心。 </li>
<li>Monitor: 统计服务的调用次数和调用时间的监控中心。</li>
</ul>
<h1 id="调用流程"><a href="#调用流程" class="headerlink" title="调用流程"></a>调用流程</h1><ol>
<li>服务容器负责启动，加载，运行服务提供者。 </li>
<li>服务提供者在启动时，向注册中心注册自己提供的服务。 </li>
<li>服务消费者在启动时，向注册中心订阅自己所需的服务。 </li>
<li>注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。 </li>
<li>服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。 </li>
<li>服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://izheyi.com/2018/08/11/Zookeeper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐胡璐">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YONGFEIUALL">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/11/Zookeeper/" itemprop="url">ZooKeeper</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-11T14:29:52+08:00">
                2018-08-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Distribution/" itemprop="url" rel="index">
                    <span itemprop="name">Distribution</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/11/Zookeeper/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2018/08/11/Zookeeper/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><a href="http://zookeeper.apache.org/" target="_blank" rel="external">ZooKeeper</a>是一个开源的分布式协调服务，他为分布式应用提供了高效且可靠的分布式协调服务，提供了诸如统一命名空间服务，配置服务和分布式锁等分布式基础服务。</p>
<p>就是一个服务注册中心。一个典型的ZooKeeper集群如下：<br><img src="/images/distributed/zk_service.jpg" alt=""></p>
<p>ZooKeeper拥有一个层次的命名空间，这个和标准的文件系统非常相似，如下图所示：<br><img src="/images/distributed/zk_namespace.jpg" alt=""></p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><ol>
<li>下载并解压；</li>
<li>创建data和log目录；</li>
<li><p>修改config - zoo.cfg；</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dataDir=/opt/zookeeper-<span class="number">3.4</span><span class="number">.13</span>/data</span><br><span class="line">dataLogDir=/opt/zookeeper-<span class="number">3.4</span><span class="number">.13</span>/<span class="built_in">log</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@Automation bin]# ./zkServer.sh <span class="operator"><span class="keyword">start</span></span><br><span class="line">ZooKeeper JMX enabled <span class="keyword">by</span> <span class="keyword">default</span></span><br><span class="line"><span class="keyword">Using</span> config: /opt/zookeeper-<span class="number">3.4</span><span class="number">.13</span>/<span class="keyword">bin</span>/../conf/zoo.cfg</span><br><span class="line"><span class="keyword">Starting</span> zookeeper ... STARTED</span><br><span class="line">[root@Automation <span class="keyword">bin</span>]# ./zkServer.sh <span class="keyword">status</span></span><br><span class="line">ZooKeeper JMX enabled <span class="keyword">by</span> <span class="keyword">default</span></span><br><span class="line"><span class="keyword">Using</span> config: /opt/zookeeper-<span class="number">3.4</span><span class="number">.13</span>/<span class="keyword">bin</span>/../conf/zoo.cfg</span><br><span class="line"><span class="keyword">Mode</span>: <span class="keyword">standalone</span></span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="命令操作"><a href="#命令操作" class="headerlink" title="命令操作"></a>命令操作</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@Automation bin]<span class="preprocessor"># ./zkCli.sh -server localhost:<span class="number">2181</span></span></span><br><span class="line">Connecting to localhost:<span class="number">2181</span></span><br><span class="line"><span class="number">2018</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">09</span>:<span class="number">26</span>:<span class="number">12</span>,<span class="number">387</span> [myid:] - INFO  [main:Environment@<span class="number">100</span>] - Client environment:zookeeper.version=<span class="number">3.4</span><span class="number">.13</span>-<span class="number">2</span>d71af4dbe22557fda74f9a9b4309b15a7487f03, built on <span class="number">06</span>/<span class="number">29</span>/<span class="number">2018</span> <span class="number">04</span>:<span class="number">05</span> GMT</span><br><span class="line"><span class="number">2018</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">09</span>:<span class="number">26</span>:<span class="number">12</span>,<span class="number">395</span> [myid:] - INFO  [main:Environment@<span class="number">100</span>] - Client environment:host.name=&lt;NA&gt;</span><br><span class="line"><span class="number">2018</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">09</span>:<span class="number">26</span>:<span class="number">12</span>,<span class="number">395</span> [myid:] - INFO  [main:Environment@<span class="number">100</span>] - Client environment:java.version=<span class="number">1.8</span><span class="number">.0</span>_11</span><br><span class="line"><span class="number">2018</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">09</span>:<span class="number">26</span>:<span class="number">12</span>,<span class="number">405</span> [myid:] - INFO  [main:Environment@<span class="number">100</span>] - Client environment:java.vendor=Oracle Corporation</span><br><span class="line"><span class="number">2018</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">09</span>:<span class="number">26</span>:<span class="number">12</span>,<span class="number">405</span> [myid:] - INFO  [main:Environment@<span class="number">100</span>] - Client environment:java.home=/usr/java/jdk1<span class="number">.8</span><span class="number">.0</span>_11/jre</span><br><span class="line"><span class="number">2018</span>-<span class="number">06</span>-<span class="number">02</span> <span class="number">09</span>:<span class="number">26</span>:<span class="number">12</span>,<span class="number">405</span> [myid:] - INFO  [main:Environment@<span class="number">100</span>] - Client environment:java.<span class="keyword">class</span>.path=/opt/zookeeper-<span class="number">3.4</span><span class="number">.13</span>/bin/../build/classes:/opt/zookeeper-<span class="number">3.4</span><span class="number">.13</span>/bin/../build/lib<span class="comment">/*.jar:/opt/zookeeper-3.4.13/bin/../lib/slf4j-log4j12-1.7.25.jar:/opt/zookeeper-3.4.13/bin/../lib/slf4j-api-1.7.25.jar:/opt/zookeeper-3.4.13/bin/../lib/netty-3.10.6.Final.jar:/opt/zookeeper-3.4.13/bin/../lib/log4j-1.2.17.jar:/opt/zookeeper-3.4.13/bin/../lib/jline-0.9.94.jar:/opt/zookeeper-3.4.13/bin/../lib/audience-annotations-0.5.0.jar:/opt/zookeeper-3.4.13/bin/../zookeeper-3.4.13.jar:/opt/zookeeper-3.4.13/bin/../src/java/lib<span class="comment">/*.jar:/opt/zookeeper-3.4.13/bin/../conf:.:/usr/java/jdk1.8.0_11/lib/dt.jar:/usr/java/jdk1.8.0_11/lib/tools.jar:/usr/java/jdk1.8.0_11/jre/lib</span><br><span class="line">2018-06-02 09:26:12,405 [myid:] - INFO  [main:Environment@100] - Client environment:java.library.path=/usr/java/packages/lib/i386:/lib:/usr/lib</span><br><span class="line">2018-06-02 09:26:12,405 [myid:] - INFO  [main:Environment@100] - Client environment:java.io.tmpdir=/tmp</span><br><span class="line">2018-06-02 09:26:12,405 [myid:] - INFO  [main:Environment@100] - Client environment:java.compiler=&lt;NA&gt;</span><br><span class="line">2018-06-02 09:26:12,405 [myid:] - INFO  [main:Environment@100] - Client environment:os.name=Linux</span><br><span class="line">2018-06-02 09:26:12,406 [myid:] - INFO  [main:Environment@100] - Client environment:os.arch=i386</span><br><span class="line">2018-06-02 09:26:12,406 [myid:] - INFO  [main:Environment@100] - Client environment:os.version=2.6.32-573.el6.x86_64</span><br><span class="line">2018-06-02 09:26:12,406 [myid:] - INFO  [main:Environment@100] - Client environment:user.name=root</span><br><span class="line">2018-06-02 09:26:12,406 [myid:] - INFO  [main:Environment@100] - Client environment:user.home=/root</span><br><span class="line">2018-06-02 09:26:12,407 [myid:] - INFO  [main:Environment@100] - Client environment:user.dir=/opt/zookeeper-3.4.13/bin</span><br><span class="line">2018-06-02 09:26:12,410 [myid:] - INFO  [main:ZooKeeper@442] - Initiating client connection, connectString=localhost:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@1e0aca6</span><br><span class="line">Welcome to ZooKeeper!</span><br><span class="line">2018-06-02 09:26:12,484 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1029] - Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2181. Will not attempt to authenticate using SASL (unknown error)</span><br><span class="line">JLine support is enabled</span><br><span class="line">2018-06-02 09:26:12,510 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@879] - Socket connection established to localhost/0:0:0:0:0:0:0:1:2181, initiating session</span><br><span class="line">2018-06-02 09:26:12,572 [myid:] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1303] - Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2181, sessionid = 0x1003ae6d0d60000, negotiated timeout = 30000</span><br><span class="line"></span><br><span class="line">WATCHER::</span><br><span class="line"></span><br><span class="line">WatchedEvent state:SyncConnected type:None path:null</span><br><span class="line">[zk: localhost:2181(CONNECTED) 0]</span></span></span><br></pre></td></tr></table></figure>
<p>这里不做过多深入学习说明，集群环境搭建，工作原理，Leader选举等，请参见官方文档。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://izheyi.com/2018/08/05/Jmeter-环境及常用插件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐胡璐">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YONGFEIUALL">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/05/Jmeter-环境及常用插件/" itemprop="url">Jmeter - 环境及常用插件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-05T08:28:27+08:00">
                2018-08-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Jmeter/" itemprop="url" rel="index">
                    <span itemprop="name">Jmeter</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/05/Jmeter-环境及常用插件/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2018/08/05/Jmeter-环境及常用插件/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>不做过多介绍，下载后，解压运行，即可使用。</p>
<h1 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h1><h1 id="插件管理"><a href="#插件管理" class="headerlink" title="插件管理"></a>插件管理</h1><p>从官网下载<a href="https://jmeter-plugins.org/downloads/all/" target="_blank" rel="external">Plugins Manager Download</a>，将其放入jmeter安装目录下的lib/ext目录，然后重启jmeter，即可。<br><img src="/images/jmeter/plugin_manager.jpg" alt=""></p>
<h1 id="常用插件"><a href="#常用插件" class="headerlink" title="常用插件"></a>常用插件</h1><p>插件管理那个我试的时候好像不好用，后来不知道为啥自己又出来了，我们可以手动的来下载配置相应的插件。</p>
<p>下载<a href="https://jmeter-plugins.org/downloads/old/" target="_blank" rel="external">Old-Style Releases</a></p>
<ul>
<li>JMeterPlugins-Standard-1.4.0.zip</li>
<li>JMeterPlugins-Extras-1.4.0.zip<br>解压，将其拷贝到jmeter的lib/ext目录下。<br><img src="/images/jmeter/plugins.jpg" alt=""></li>
</ul>
<h2 id="OS监控"><a href="#OS监控" class="headerlink" title="OS监控"></a>OS监控</h2><p>从此下载<a href="https://github.com/undera/perfmon-agent" target="_blank" rel="external">PerfMon Server Agent</a>。</p>
<ol>
<li>上传到Server，并启动。</li>
<li>客户端监听<br><img src="/images/jmeter/perfmon.jpg" alt=""></li>
</ol>
<h2 id="Stepping-Thread-Group-amp-Concurrency-Thread-Group"><a href="#Stepping-Thread-Group-amp-Concurrency-Thread-Group" class="headerlink" title="Stepping Thread Group &amp; Concurrency Thread Group"></a>Stepping Thread Group &amp; Concurrency Thread Group</h2><p><img src="/images/jmeter/thread_group.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://izheyi.com/2018/07/29/Java项目实战-项目部署/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐胡璐">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YONGFEIUALL">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/29/Java项目实战-项目部署/" itemprop="url">Java项目实战 - 项目部署</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-29T14:08:46+08:00">
                2018-07-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/29/Java项目实战-项目部署/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2018/07/29/Java项目实战-项目部署/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>项目实现分布式部署。</p>
<h1 id="系统规划"><a href="#系统规划" class="headerlink" title="系统规划"></a>系统规划</h1><h2 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h2><ul>
<li>zheyi-manager : manager.zheyi.com</li>
<li>zheyi-portal : www.zheyi.com</li>
<li>zheyi-rest : rest.zheyi.com</li>
<li>zheyi-sso : sso.zheyi.com</li>
<li>zheyi-search : search.zheyi.com</li>
</ul>
<p>所有的域名都配置指向代理服务器（Nginx）。</p>
<ul>
<li>192.168.22.138 : manager.zheyi.com</li>
<li>192.168.22.138 : www.zheyi.com</li>
<li>192.168.22.138 : rest.zheyi.com</li>
<li>192.168.22.138 : sso.zheyi.com</li>
<li>192.168.22.138 : search.zheyi.com</li>
</ul>
<h2 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h2><ul>
<li>图片Server</li>
<li>Redis集群</li>
<li>Solr集群</li>
<li>DB Server</li>
<li>Nginx Server</li>
<li>zheyi-manager</li>
<li>zheyi-portal</li>
<li>zheyi-sso</li>
<li>zheyi-search</li>
<li>zheyi-rest</li>
</ul>
<p>至少要10台VM。</p>
<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><p>用Nginx来实现反向代理服务器。</p>
<h2 id="虚拟主机"><a href="#虚拟主机" class="headerlink" title="虚拟主机"></a>虚拟主机</h2><p>nginx支持三种类型的虚拟主机配置：</p>
<ol>
<li>基于ip的虚拟主机</li>
<li>基于域名的虚拟主机 </li>
<li>基于端口的虚拟主机<br>一般都用第3种方式来实现。<h2 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h2>而反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。</li>
</ol>
<p>配置：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">upstream</span> manager.zheyi.com &#123;</span><br><span class="line">	<span class="title">server</span> <span class="number">192.168.22.135:8080</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title">upstream</span> rest.zheyi.com &#123;</span><br><span class="line">	<span class="title">server</span> <span class="number">192.168.22.136:8080</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title">upstream</span> search.zheyi.com &#123;</span><br><span class="line">	<span class="title">server</span> <span class="number">192.168.22.136:8081</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title">upstream</span> sso.zheyi.com &#123;</span><br><span class="line">	<span class="title">server</span> <span class="number">192.168.22.136:8082</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title">upstream</span> order.zheyi.com &#123;</span><br><span class="line">	<span class="title">server</span> <span class="number">192.168.22.136:8083</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title">upstream</span> www.zheyi.com &#123;</span><br><span class="line">	<span class="title">server</span> <span class="number">192.168.22.137:8080</span>;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="title">server</span> &#123;</span><br><span class="line">        <span class="title">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="title">server_name</span>  manager.zheyi.com;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">        <span class="title">location</span> / &#123;</span><br><span class="line">            <span class="title">proxy_pass</span>   <span class="url">http://manager.zheyi.com</span>;</span><br><span class="line">            <span class="title">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title">server</span> &#123;</span><br><span class="line">        <span class="title">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="title">server_name</span>  rest.zheyi.com;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">        <span class="title">location</span> / &#123;</span><br><span class="line">            <span class="title">proxy_pass</span>   <span class="url">http://rest.zheyi.com</span>;</span><br><span class="line">            <span class="title">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title">server</span> &#123;</span><br><span class="line">        <span class="title">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="title">server_name</span>  search.zheyi.com;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">        <span class="title">location</span> / &#123;</span><br><span class="line">            <span class="title">proxy_pass</span>   <span class="url">http://search.zheyi.com</span>;</span><br><span class="line">            <span class="title">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title">server</span> &#123;</span><br><span class="line">        <span class="title">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="title">server_name</span>  sso.zheyi.com;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">        <span class="title">location</span> / &#123;</span><br><span class="line">            <span class="title">proxy_pass</span>   <span class="url">http://sso.zheyi.com</span>;</span><br><span class="line">            <span class="title">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title">server</span> &#123;</span><br><span class="line">        <span class="title">listen</span>       <span class="number">80</span>;</span><br><span class="line">        <span class="title">server_name</span>  www.zheyi.com;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#charset koi8-r;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#access_log  logs/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">        <span class="title">location</span> / &#123;</span><br><span class="line">            <span class="title">proxy_pass</span>   <span class="url">http://www.zheyi.com</span>;</span><br><span class="line">            <span class="title">index</span>  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h2><p>根据不同策略来实现。</p>
<h1 id="Tomcat热部署"><a href="#Tomcat热部署" class="headerlink" title="Tomcat热部署"></a>Tomcat热部署</h1><p>使用maven实现tomcat的热部署。</p>
<ol>
<li><p>在Tomcat中配置用户权限(conf/tomcat-user.xml)</p>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">role</span> <span class="attribute">rolename</span>=<span class="value">"manager-gui"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">role</span> <span class="attribute">rolename</span>=<span class="value">"manager-script"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">user</span> <span class="attribute">username</span>=<span class="value">"tomcat"</span> <span class="attribute">password</span>=<span class="value">"tomcat"</span> <span class="attribute">roles</span>=<span class="value">"manager-gui, manager-script"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改工程pom文件(build)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">url</span>&gt;</span>http://$&#123;deploy server ip&#125;:8080/manager/text<span class="tag">&lt;/<span class="title">url</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">username</span>&gt;</span>tomcat<span class="tag">&lt;/<span class="title">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">password</span>&gt;</span>tomcat<span class="tag">&lt;/<span class="title">password</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>执行Maven Build，即可实现热部署。</p>
</li>
</ol>
<p>整个POC到此完工，明白了基本的开发流程和中间应用到的框架和工具。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://izheyi.com/2018/07/28/Java项目实战-SSO集成Portal/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐胡璐">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YONGFEIUALL">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/28/Java项目实战-SSO集成Portal/" itemprop="url">Java项目实战-SSO集成Portal</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-28T20:13:42+08:00">
                2018-07-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/28/Java项目实战-SSO集成Portal/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2018/07/28/Java项目实战-SSO集成Portal/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="业务"><a href="#业务" class="headerlink" title="业务"></a>业务</h1><p>在Portal点击登录跳转到SSO登录页面，登录后，跳转到Portal首页。</p>
<h1 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h1><p>在Portal中需要从cookie中把token取出来。所以必须在登录成功后把token写入cookie，且cookie的值必须在系统之间能共享。<br>要在SsoService加上cookie:<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">	<span class="keyword">public</span> TaotaoResult userLogin(<span class="built_in">String</span> username, <span class="built_in">String</span> password, HttpServletRequest request, HttpServletResponse response) &#123;</span><br><span class="line">		TbUserExample example = <span class="literal">new</span> TbUserExample();</span><br><span class="line">		Criteria criteria = example<span class="built_in">.</span>createCriteria();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// username</span></span><br><span class="line">		criteria<span class="built_in">.</span>andUsernameEqualTo(username);</span><br><span class="line">		<span class="built_in">List</span>&lt;TbUser&gt; <span class="built_in">list</span> = userMapper<span class="built_in">.</span>selectByExample(example);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">list</span> == <span class="built_in">null</span> <span class="subst">||</span> <span class="built_in">list</span><span class="built_in">.</span>size() == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> TaotaoResult<span class="built_in">.</span>build(<span class="number">400</span>, <span class="string">"username or password wrong"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// password</span></span><br><span class="line">		TbUser user = <span class="built_in">list</span><span class="built_in">.</span>get(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span> (<span class="subst">!</span>DigestUtils<span class="built_in">.</span>md5DigestAsHex(password<span class="built_in">.</span>getBytes())<span class="built_in">.</span><span class="keyword">equals</span>(user<span class="built_in">.</span>getPassword())) &#123;</span><br><span class="line">			<span class="keyword">return</span> TaotaoResult<span class="built_in">.</span>build(<span class="number">400</span>, <span class="string">"username or password wrong"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// token</span></span><br><span class="line">		<span class="built_in">String</span> token = UUID<span class="built_in">.</span>randomUUID()<span class="built_in">.</span>toString();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// add redis</span></span><br><span class="line">		redisPool<span class="built_in">.</span><span class="built_in">set</span>(SSO_SESSION_KEY + <span class="string">":"</span> + token, JsonUtils<span class="built_in">.</span>objectToJson(user));</span><br><span class="line">		redisPool<span class="built_in">.</span>expire(SSO_SESSION_KEY + <span class="string">":"</span> + token, SSO_SESSION_EXPIRE);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// add cookie</span></span><br><span class="line">		CookieUtils<span class="built_in">.</span>setCookie(request, response, <span class="string">"Z_TOKEN"</span>, token);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//return token</span></span><br><span class="line">		<span class="keyword">return</span> TaotaoResult<span class="built_in">.</span>ok(token);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h1><p>Interceptor拦截器用于拦截Controller层接口，以下3个步骤实现：</p>
<ol>
<li>需要实现HandlerInterceptor接口。</li>
<li>实现拦截逻辑</li>
<li>需要在springmvc.xml中配置。</li>
</ol>
<h2 id="实现HandlerInterceptor接口"><a href="#实现HandlerInterceptor接口" class="headerlink" title="实现HandlerInterceptor接口"></a>实现HandlerInterceptor接口</h2><p>Service:<br><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">Service</span></span><br><span class="line">public class <span class="type">UserServiceImpl</span> implements <span class="type">UserService</span> &#123;</span><br><span class="line">	</span><br><span class="line">	@<span class="type">Value</span>(<span class="string">"$&#123;SSO_BASE_URL&#125;"</span>)</span><br><span class="line">	public <span class="type">String</span> <span class="type">SSO_BASE_URL</span>;</span><br><span class="line">	@<span class="type">Value</span>(<span class="string">"$&#123;SSO_USER_TOKEN&#125;"</span>)</span><br><span class="line">	public <span class="type">String</span> <span class="type">SSO_USER_TOKEN</span>;</span><br><span class="line">	@<span class="type">Value</span>(<span class="string">"$&#123;SSO_USER_LOGIN&#125;"</span>)</span><br><span class="line">	public <span class="type">String</span> <span class="type">SSO_USER_LOGIN</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public <span class="type">TbUser</span> getUserByToken(<span class="type">String</span> token) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">String</span> json = <span class="type">HttpClientUtil</span>.doGet(<span class="type">SSO_BASE_URL</span> + <span class="type">SSO_USER_TOKEN</span> + token);</span><br><span class="line">			<span class="type">TaotaoResult</span> <span class="literal">result</span> = <span class="type">TaotaoResult</span>.formatToPojo(json, <span class="type">TbUser</span>.class);</span><br><span class="line">			<span class="keyword">if</span> (<span class="literal">result</span>.getStatus() == <span class="number">200</span>) &#123;</span><br><span class="line">				<span class="type">TbUser</span> user = (<span class="type">TbUser</span>) <span class="literal">result</span>.getData();</span><br><span class="line">				<span class="keyword">return</span> user;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (<span class="type">Exception</span> e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> null;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Interceptor:<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="annotation">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> UserServiceImpl userService;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object <span class="keyword">handler</span>)</span></span><br><span class="line">			<span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">/// get token from cookie</span></span><br><span class="line">		String token = CookieUtils.getCookieValue(request, <span class="string">"Z_TOKEN"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// get user by token</span></span><br><span class="line">		TbUser user = userService.getUserByToken(token);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line">			response.sendRedirect(userService.SSO_BASE_URL + userService.SSO_USER_LOGIN </span><br><span class="line">					+ <span class="string">"?redirect="</span> + request.getRequestURI());</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>springmvc.xml:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 拦截器配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">mvc:interceptors</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">mvc:interceptor</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 拦截订单类请求 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">mvc:mapping</span> <span class="attribute">path</span>=<span class="value">"/item/**"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">bean</span> <span class="attribute">class</span>=<span class="value">"com.izheyi.portal.interceptor.LoginInterceptor"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><img src="/images/javaproject/interceptor.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://izheyi.com/2018/07/28/Java项目实战-SSO/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐胡璐">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YONGFEIUALL">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/28/Java项目实战-SSO/" itemprop="url">Java项目实战-SSO</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-28T16:49:00+08:00">
                2018-07-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/28/Java项目实战-SSO/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2018/07/28/Java项目实战-SSO/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>创建一个新工程zheyi-sso，要用到Redis和DB。</p>
<h1 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h1><p>在注册用户之前，要先检查注册的用户信息的正确性。</p>
<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line"> * check user date</span><br><span class="line"> * @see com.izheyi.sso.service.SsoService#checkUserData(java.lang.String, java.lang.Integer)</span><br><span class="line"> */</span></span><br><span class="line">@Override</span><br><span class="line"><span class="keyword">public</span> TaotaoResult checkUserData(<span class="built_in">String</span> content, <span class="built_in">Integer</span> <span class="keyword">type</span>) &#123;</span><br><span class="line">	TbUserExample userExample = <span class="literal">new</span> TbUserExample();</span><br><span class="line">	Criteria criteria = userExample<span class="built_in">.</span>createCriteria();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">type</span> == <span class="number">1</span>) &#123;</span><br><span class="line">		criteria<span class="built_in">.</span>andUsernameEqualTo(content);</span><br><span class="line">	&#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">type</span> == <span class="number">2</span>) &#123;</span><br><span class="line">		criteria<span class="built_in">.</span>andPhoneEqualTo(content);</span><br><span class="line">	&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">		criteria<span class="built_in">.</span>andEmailEqualTo(content);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">List</span>&lt;TbUser&gt; <span class="built_in">list</span> = userMapper<span class="built_in">.</span>selectByExample(userExample);</span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">list</span> == <span class="built_in">null</span> <span class="subst">||</span> <span class="built_in">list</span><span class="built_in">.</span>size() == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> TaotaoResult<span class="built_in">.</span>ok(<span class="literal">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> TaotaoResult<span class="built_in">.</span>ok(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span><br><span class="line"> * create user</span><br><span class="line"> * @see com.izheyi.sso.service.SsoService#createUser(com.izheyi.pojo.TbUser)</span><br><span class="line"> */</span></span><br><span class="line">@Override</span><br><span class="line"><span class="keyword">public</span> TaotaoResult createUser(TbUser user) &#123;</span><br><span class="line">	user<span class="built_in">.</span>setCreated(<span class="literal">new</span> <span class="built_in">Date</span>());</span><br><span class="line">	user<span class="built_in">.</span>setUpdated(<span class="literal">new</span> <span class="built_in">Date</span>());</span><br><span class="line">	</span><br><span class="line">	user<span class="built_in">.</span>setPassword(DigestUtils<span class="built_in">.</span>md5DigestAsHex(user<span class="built_in">.</span>getPassword()<span class="built_in">.</span>getBytes()));</span><br><span class="line">	userMapper<span class="built_in">.</span>insert(user);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> TaotaoResult<span class="built_in">.</span>ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h2><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">	 * check user data</span><br><span class="line">	 */</span><br><span class="line">	@<span class="type">RequestMapping</span>(<span class="string">"/check/&#123;param&#125;/&#123;type&#125;"</span>)</span><br><span class="line">	@<span class="type">ResponseBody</span></span><br><span class="line">	public <span class="type">Object</span> checkUserData(@<span class="type">PathVariable</span> <span class="type">String</span> param, @<span class="type">PathVariable</span> <span class="type">Integer</span> <span class="keyword">type</span>, <span class="type">String</span> callback) &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="type">TaotaoResult</span> <span class="literal">result</span> = null;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="literal">result</span> = ssoService.checkUserData(param, <span class="keyword">type</span>);</span><br><span class="line">		&#125; catch (<span class="type">Exception</span> e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (!<span class="type">StringUtils</span>.isBlank(callback)) &#123;</span><br><span class="line">			<span class="type">MappingJacksonValue</span> mappingJacksonValue = new <span class="type">MappingJacksonValue</span>(<span class="literal">result</span>);</span><br><span class="line">			mappingJacksonValue.setJsonpFunction(callback);</span><br><span class="line">			<span class="keyword">return</span> mappingJacksonValue;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">result</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	/*</span><br><span class="line">	 * create user</span><br><span class="line">	 */</span><br><span class="line">	@<span class="type">RequestMapping</span>(value=<span class="string">"/register"</span>, <span class="keyword">method</span>=<span class="type">RequestMethod</span>.<span class="type">POST</span>)</span><br><span class="line">	@<span class="type">ResponseBody</span></span><br><span class="line">	public <span class="type">TaotaoResult</span> createUser(<span class="type">TbUser</span> user) &#123;</span><br><span class="line">		<span class="type">TaotaoResult</span> <span class="literal">result</span> = null;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="literal">result</span> = ssoService.createUser(user);</span><br><span class="line">			</span><br><span class="line">		&#125; catch (<span class="type">Exception</span> e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">result</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/javaproject/sso_user_register.jpg" alt=""></p>
<h1 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h1><h2 id="Service-1"><a href="#Service-1" class="headerlink" title="Service"></a>Service</h2><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">	<span class="keyword">public</span> TaotaoResult userLogin(<span class="built_in">String</span> username, <span class="built_in">String</span> password) &#123;</span><br><span class="line">		TbUserExample example = <span class="literal">new</span> TbUserExample();</span><br><span class="line">		Criteria criteria = example<span class="built_in">.</span>createCriteria();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// username</span></span><br><span class="line">		criteria<span class="built_in">.</span>andUsernameEqualTo(username);</span><br><span class="line">		<span class="built_in">List</span>&lt;TbUser&gt; <span class="built_in">list</span> = userMapper<span class="built_in">.</span>selectByExample(example);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">list</span> == <span class="built_in">null</span> <span class="subst">||</span> <span class="built_in">list</span><span class="built_in">.</span>size() == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> TaotaoResult<span class="built_in">.</span>build(<span class="number">400</span>, <span class="string">"username or password wrong"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// password</span></span><br><span class="line">		TbUser user = <span class="built_in">list</span><span class="built_in">.</span>get(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span> (<span class="subst">!</span>DigestUtils<span class="built_in">.</span>md5DigestAsHex(password<span class="built_in">.</span>getBytes())<span class="built_in">.</span><span class="keyword">equals</span>(user<span class="built_in">.</span>getPassword())) &#123;</span><br><span class="line">			<span class="keyword">return</span> TaotaoResult<span class="built_in">.</span>build(<span class="number">400</span>, <span class="string">"username or password wrong"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// token</span></span><br><span class="line">		<span class="built_in">String</span> token = UUID<span class="built_in">.</span>randomUUID()<span class="built_in">.</span>toString();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// add redis</span></span><br><span class="line">		redisPool<span class="built_in">.</span><span class="built_in">set</span>(SSO_SESSION_KEY + <span class="string">":"</span> + token, JsonUtils<span class="built_in">.</span>objectToJson(user));</span><br><span class="line">		redisPool<span class="built_in">.</span>expire(SSO_SESSION_KEY + <span class="string">":"</span> + token, SSO_SESSION_EXPIRE);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//return token</span></span><br><span class="line">		<span class="keyword">return</span> TaotaoResult<span class="built_in">.</span>ok(token);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Controller-1"><a href="#Controller-1" class="headerlink" title="Controller"></a>Controller</h2><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">RequestMapping</span>(value=<span class="string">"/login"</span>, <span class="keyword">method</span>=<span class="type">RequestMethod</span>.<span class="type">POST</span>)</span><br><span class="line">@<span class="type">ResponseBody</span></span><br><span class="line">public <span class="type">TaotaoResult</span> userLogin(<span class="type">String</span> username, <span class="type">String</span> password)&#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">TaotaoResult</span> <span class="literal">result</span> = ssoService.userLogin(username, password);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">result</span>;</span><br><span class="line">	&#125; catch (<span class="type">Exception</span> e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">		<span class="keyword">return</span> <span class="type">TaotaoResult</span>.build(<span class="number">500</span>, <span class="type">ExceptionUtil</span>.getStackTrace(e));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/javaproject/sso_user_login.jpg" alt=""></p>
<h1 id="查询用户-By-Token"><a href="#查询用户-By-Token" class="headerlink" title="查询用户 By Token"></a>查询用户 By Token</h1><h2 id="Service-2"><a href="#Service-2" class="headerlink" title="Service"></a>Service</h2><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">Override</span></span><br><span class="line">public <span class="type">TaotaoResult</span> getUserByToken(<span class="type">String</span> token) &#123;</span><br><span class="line">	<span class="type">String</span> <span class="literal">result</span> = redisPool.get(<span class="type">SSO_SESSION_KEY</span> + <span class="string">":"</span> + token);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (<span class="type">StringUtils</span>.isBlank(<span class="literal">result</span>)) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="type">TaotaoResult</span>.build(<span class="number">400</span>, <span class="string">"session expired, please relogin"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	redisPool.expire(<span class="type">SSO_SESSION_KEY</span> + <span class="string">":"</span> + token, <span class="type">SSO_SESSION_EXPIRE</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="type">TaotaoResult</span>.ok(<span class="type">JsonUtils</span>.jsonToPojo(<span class="literal">result</span>, <span class="type">TbUser</span>.class));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Controller-2"><a href="#Controller-2" class="headerlink" title="Controller"></a>Controller</h2><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">RequestMapping</span>(<span class="string">"/token/&#123;token&#125;"</span>)</span><br><span class="line">@<span class="type">ResponseBody</span></span><br><span class="line">public <span class="type">Object</span> getUserByToken(@<span class="type">PathVariable</span> <span class="type">String</span> token, <span class="type">String</span> callback) &#123;</span><br><span class="line">	<span class="type">TaotaoResult</span> <span class="literal">result</span> = null;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="literal">result</span> = ssoService.getUserByToken(token);</span><br><span class="line">	&#125; catch (<span class="type">Exception</span> e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">		<span class="literal">result</span> = <span class="type">TaotaoResult</span>.build(<span class="number">500</span>, <span class="type">ExceptionUtil</span>.getStackTrace(e));</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (!<span class="type">StringUtils</span>.isBlank(callback)) &#123;</span><br><span class="line">		<span class="type">MappingJacksonValue</span> mappingJacksonValue = new <span class="type">MappingJacksonValue</span>(<span class="literal">result</span>);</span><br><span class="line">		mappingJacksonValue.setJsonpFunction(callback);</span><br><span class="line">		<span class="keyword">return</span> mappingJacksonValue;</span><br><span class="line">	&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">result</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/javaproject/sso_user_token.jpg" alt=""></p>
<h1 id="实现SSO功能"><a href="#实现SSO功能" class="headerlink" title="实现SSO功能"></a>实现SSO功能</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Controller</span></span><br><span class="line"><span class="annotation">@RequestMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="annotation">@RequestMapping</span>(<span class="string">"/register"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">registerPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"register"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="annotation">@RequestMapping</span>(<span class="string">"/login"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">loginPage</span><span class="params">(String redirect, Model model)</span> </span>&#123;</span><br><span class="line">		model.addAttribute(<span class="string">"redirect"</span>, redirect);</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这，登录和注册的功能在SSO系统中完成，其他系统可调用。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://izheyi.com/2018/07/25/Java项目实战-展示商品详情页/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐胡璐">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YONGFEIUALL">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/25/Java项目实战-展示商品详情页/" itemprop="url">Java项目实战 - 展示商品详情页</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-25T12:54:48+08:00">
                2018-07-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/25/Java项目实战-展示商品详情页/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2018/07/25/Java项目实战-展示商品详情页/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="发布服务"><a href="#发布服务" class="headerlink" title="发布服务"></a>发布服务</h1><p>zheyi-rest实现：商品基本信息和描述的显示，并添加缓存。</p>
<h1 id="Dao"><a href="#Dao" class="headerlink" title="Dao"></a>Dao</h1><p>无。</p>
<h1 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h1><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemServiceImpl</span> <span class="keyword">implements</span> <span class="title">ItemService</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="annotation">@Value</span>(<span class="string">"$&#123;REDIS_ITEM_KEY&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> String REDIS_ITEM_KEY;</span><br><span class="line">	<span class="annotation">@Value</span>(<span class="string">"$&#123;REDIS_ITEM_EXPIRE&#125;"</span>)</span><br><span class="line">	<span class="keyword">private</span> Integer REDIS_ITEM_EXPIRE;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="annotation">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> TbItemMapper itemMapper;</span><br><span class="line">	</span><br><span class="line">	<span class="annotation">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> TbItemDescMapper itemDescMapper;</span><br><span class="line">	</span><br><span class="line">	<span class="annotation">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> RedisUtils redisUtils;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function">TaotaoResult <span class="title">getItemBasicInfo</span><span class="params">(<span class="keyword">long</span> itemId)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//get cache</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			String cache = redisUtils.get(REDIS_ITEM_KEY + <span class="string">":"</span> + itemId + <span class="string">":basic"</span>);</span><br><span class="line">			<span class="keyword">if</span> (!StringUtils.isBlank(cache)) &#123;</span><br><span class="line">				TbItem item = JsonUtils.jsonToPojo(cache, TbItem.class);</span><br><span class="line">				<span class="function"><span class="keyword">return</span> TaotaoResult.<span class="title">ok</span><span class="params">(item)</span></span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		TbItem item = itemMapper.selectByPrimaryKey(itemId);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//add cache</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			redisUtils.set(REDIS_ITEM_KEY + <span class="string">":"</span> + itemId + <span class="string">":basic"</span>, JsonUtils.objectToJson(item));</span><br><span class="line">			redisUtils.expire(REDIS_ITEM_KEY + <span class="string">":"</span> + itemId + <span class="string">":basic"</span>, REDIS_ITEM_EXPIRE);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">return</span> TaotaoResult.<span class="title">ok</span><span class="params">(item)</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="function">TaotaoResult <span class="title">getItemDesc</span><span class="params">(<span class="keyword">long</span> itemId)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//get cache</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			String cache = redisUtils.get(REDIS_ITEM_KEY + <span class="string">":"</span> + itemId + <span class="string">":desc"</span>);</span><br><span class="line">			<span class="keyword">if</span> (!StringUtils.isBlank(cache)) &#123;</span><br><span class="line">				</span><br><span class="line">				TbItemDesc itemDesc = JsonUtils.jsonToPojo(cache, TbItemDesc.class);</span><br><span class="line">				<span class="function"><span class="keyword">return</span> TaotaoResult.<span class="title">ok</span><span class="params">(itemDesc)</span></span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		TbItemDesc itemDesc = itemDescMapper.selectByPrimaryKey(itemId);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//add cache</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			redisUtils.set(REDIS_ITEM_KEY + <span class="string">":"</span> + itemId + <span class="string">":desc"</span>, JsonUtils.objectToJson(itemDesc));</span><br><span class="line">			redisUtils.expire(REDIS_ITEM_KEY + <span class="string">":"</span> + itemId + <span class="string">":desc"</span>, REDIS_ITEM_EXPIRE);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">return</span> TaotaoResult.<span class="title">ok</span><span class="params">(itemDesc)</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Portal调用"><a href="#Portal调用" class="headerlink" title="Portal调用"></a>Portal调用</h1><p>zheyi-portal实现：当用户访问商品详情页面时，需要加载商品信息。</p>
<h1 id="Dao-1"><a href="#Dao-1" class="headerlink" title="Dao"></a>Dao</h1><p>需要添加POJO:<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ItemInfo</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">TbItem</span>&#123;</span></span><br><span class="line">	</span><br><span class="line">	public <span class="type">String</span>[] getImages() &#123;</span><br><span class="line">		<span class="type">String</span> image = getImage();</span><br><span class="line">		<span class="keyword">if</span> (image != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="type">String</span>[] images = image.split(<span class="string">","</span>);</span><br><span class="line">			<span class="keyword">return</span> images;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="Service-1"><a href="#Service-1" class="headerlink" title="Service"></a>Service</h1><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">Service</span></span><br><span class="line">public class <span class="type">ItemServiceImpl</span> implements <span class="type">ItemService</span> &#123;</span><br><span class="line">	</span><br><span class="line">	@<span class="type">Value</span>(<span class="string">"$&#123;REST_BASE_URL&#125;"</span>)</span><br><span class="line">	private <span class="type">String</span> <span class="type">REST_BASE_URL</span>;</span><br><span class="line">	@<span class="type">Value</span>(<span class="string">"$&#123;ITEM_INFO&#125;"</span>)</span><br><span class="line">	private <span class="type">String</span> <span class="type">ITEM_INFO</span>;</span><br><span class="line">	@<span class="type">Value</span>(<span class="string">"$&#123;ITEM_DESC_URL&#125;"</span>)</span><br><span class="line">	private <span class="type">String</span> <span class="type">ITEM_DESC_URL</span>;</span><br><span class="line"></span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public <span class="type">ItemInfo</span> getItemById(<span class="type">Long</span> itemId) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">String</span> itemJson = <span class="type">HttpClientUtil</span>.doGet(<span class="type">REST_BASE_URL</span> + <span class="type">ITEM_INFO</span> + itemId);</span><br><span class="line">			<span class="keyword">if</span> (!<span class="type">StringUtils</span>.isBlank(itemJson)) &#123;</span><br><span class="line">				<span class="type">TaotaoResult</span> <span class="literal">result</span> = <span class="type">TaotaoResult</span>.formatToPojo(itemJson, <span class="type">ItemInfo</span>.class);</span><br><span class="line">				<span class="keyword">if</span> (<span class="literal">result</span>.getStatus() == <span class="number">200</span>) &#123;</span><br><span class="line">					<span class="type">ItemInfo</span> itemInfo = (<span class="type">ItemInfo</span>) <span class="literal">result</span>.getData();</span><br><span class="line">					<span class="keyword">return</span> itemInfo;</span><br><span class="line">				&#125;	</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (<span class="type">Exception</span> e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> null;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public <span class="type">String</span> getItemDescById(<span class="type">Long</span> itemId) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			//查询商品描述</span><br><span class="line">			<span class="type">String</span> json = <span class="type">HttpClientUtil</span>.doGet(<span class="type">REST_BASE_URL</span> + <span class="type">ITEM_DESC_URL</span> + itemId);</span><br><span class="line">			//转换成java对象</span><br><span class="line">			<span class="type">TaotaoResult</span> taotaoResult = <span class="type">TaotaoResult</span>.formatToPojo(json, <span class="type">TbItemDesc</span>.class);</span><br><span class="line">			<span class="keyword">if</span> (taotaoResult.getStatus() == <span class="number">200</span>) &#123;</span><br><span class="line">				<span class="type">TbItemDesc</span> itemDesc = (<span class="type">TbItemDesc</span>) taotaoResult.getData();</span><br><span class="line">				//取商品描述信息</span><br><span class="line">				<span class="type">String</span> <span class="literal">result</span> = itemDesc.getItemDesc();</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">result</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (<span class="type">Exception</span> e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> null;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h1><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> ItemController &#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ItemService itemService;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">@RequestMapping</span>(<span class="string">"/item/&#123;itemId&#125;"</span>)</span><br><span class="line">	<span class="keyword">public</span> String getItem(<span class="keyword">@PathVariable</span> Long itemId, Model model)&#123;</span><br><span class="line">		ItemInfo itemInfo = itemService.getItemById(itemId);</span><br><span class="line">		</span><br><span class="line">		model.addAttribute(<span class="string">"item"</span>, itemInfo);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"item"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">@RequestMapping</span>(value=<span class="string">"/item/desc/&#123;itemId&#125;"</span>, produces=MediaType.TEXT_HTML_VALUE+<span class="string">";charset=utf-8"</span>)</span><br><span class="line">	<span class="keyword">@ResponseBody</span></span><br><span class="line">	<span class="keyword">public</span> String getItemDesc(<span class="keyword">@PathVariable</span> Long itemId) &#123;</span><br><span class="line">		String <span class="built_in">string</span> = itemService.getItemDescById(itemId);</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">string</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/javaproject/rest_item_detail_service.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://izheyi.com/2018/07/22/Java项目实战-solr实现前端商品搜索/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐胡璐">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YONGFEIUALL">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/22/Java项目实战-solr实现前端商品搜索/" itemprop="url">Java项目实战 - solr实现前端商品搜索</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-22T21:49:11+08:00">
                2018-07-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/22/Java项目实战-solr实现前端商品搜索/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2018/07/22/Java项目实战-solr实现前端商品搜索/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在zheyi-portal工程中实现。</p>
<h1 id="Dao"><a href="#Dao" class="headerlink" title="Dao"></a>Dao</h1><p>无。</p>
<h1 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h1><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">Service</span></span><br><span class="line">public class <span class="type">SearchServiceImpl</span> implements <span class="type">SearchService</span> &#123;</span><br><span class="line">	</span><br><span class="line">	@<span class="type">Value</span>(<span class="string">"$&#123;SEARCH_BASE_URL&#125;"</span>)</span><br><span class="line">	private <span class="type">String</span> <span class="type">SEARCH_BASE_URL</span>;</span><br><span class="line"></span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public <span class="type">SearchResult</span> search(<span class="type">String</span> query, <span class="type">int</span> page) &#123;</span><br><span class="line">		<span class="type">Map</span>&lt;<span class="type">String</span>, <span class="type">String</span>&gt; param = new <span class="type">HashMap</span>&lt;&gt;();</span><br><span class="line">		param.put(<span class="string">"q"</span>, query);</span><br><span class="line">		param.put(<span class="string">"page"</span>, page + <span class="string">""</span>);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="type">String</span> getString = <span class="type">HttpClientUtil</span>.doGet(<span class="type">SEARCH_BASE_URL</span>, param);</span><br><span class="line">			<span class="type">TaotaoResult</span> <span class="literal">result</span> = <span class="type">TaotaoResult</span>.formatToPojo(getString, <span class="type">SearchResult</span>.class);</span><br><span class="line">			<span class="keyword">if</span> (<span class="literal">result</span>.getStatus() == <span class="number">200</span>) &#123;</span><br><span class="line">				<span class="type">SearchResult</span> searchResult = (<span class="type">SearchResult</span>) <span class="literal">result</span>.getData();</span><br><span class="line">				<span class="keyword">return</span> searchResult;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; catch (<span class="type">Exception</span> e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> null;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h1><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Controller</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">SearchServiceController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="annotation">@Autowired</span></span><br><span class="line">	private SearchService searchService;</span><br><span class="line">	</span><br><span class="line">	<span class="annotation">@RequestMapping</span>(<span class="string">"/search"</span>)</span><br><span class="line">	public <span class="built_in">String</span> search(<span class="annotation">@RequestParam</span>(<span class="string">"q"</span>)<span class="built_in">String</span> query, <span class="annotation">@RequestParam</span>(defaultValue=<span class="string">"1"</span>)Integer page, </span><br><span class="line">			Model model) &#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span> (query != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				query = <span class="keyword">new</span> <span class="built_in">String</span>(query.getBytes(<span class="string">"iso8859-1"</span>), <span class="string">"utf-8"</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">		SearchResult searchResult = searchService.search(query, page);</span><br><span class="line">		</span><br><span class="line">		model.addAttribute(<span class="string">"query"</span>, query);</span><br><span class="line">		model.addAttribute(<span class="string">"totalPages"</span>, searchResult.getTotalPageCount());</span><br><span class="line">		model.addAttribute(<span class="string">"itemList"</span>, searchResult.getItemList());</span><br><span class="line">		model.addAttribute(<span class="string">"page"</span>, page);</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"search"</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://izheyi.com/2018/07/22/Java项目实战-solr发布搜索服务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐胡璐">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YONGFEIUALL">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/22/Java项目实战-solr发布搜索服务/" itemprop="url">Java项目实战 - solr发布搜索服务</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-22T17:34:20+08:00">
                2018-07-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/22/Java项目实战-solr发布搜索服务/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2018/07/22/Java项目实战-solr发布搜索服务/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>发布搜索服务供其它工程调用。</p>
<h1 id="Dao"><a href="#Dao" class="headerlink" title="Dao"></a>Dao</h1><p>要定义返回的POJO：<br><figure class="highlight zephir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchResult</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">List</span>&lt;Item&gt; itemList;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> totalItemCount;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> totalPageCount;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> currentPageNumber;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> currentRowCount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>并实现Dao:<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Repository</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">SearchDaoImpl</span> <span class="keyword">implements</span> <span class="title">SearchDao</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="annotation">@Autowired</span></span><br><span class="line">	private SolrServer solrServer;</span><br><span class="line"></span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	public SearchResult search(SolrQuery query) throws Exception &#123;</span><br><span class="line">		<span class="comment">// return result</span></span><br><span class="line">		SearchResult resultList = <span class="keyword">new</span> SearchResult();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// solr search</span></span><br><span class="line">		QueryResponse response =  solrServer.query(query);</span><br><span class="line">		SolrDocumentList solrDocumentList = response.getResults();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// highlight</span></span><br><span class="line">		<span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt;&gt;&gt; highlighting = response.getHighlighting();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//get item list</span></span><br><span class="line">		<span class="built_in">List</span>&lt;Item&gt; itemList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (SolrDocument solrDocument : solrDocumentList) &#123;</span><br><span class="line">			Item item = <span class="keyword">new</span> Item();</span><br><span class="line">			</span><br><span class="line">			item.setId((<span class="built_in">String</span>) solrDocument.<span class="literal">get</span>(<span class="string">"id"</span>));</span><br><span class="line">			<span class="comment">//get highlight</span></span><br><span class="line">			<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; list = highlighting.<span class="literal">get</span>(solrDocument.<span class="literal">get</span>(<span class="string">"id"</span>)).<span class="literal">get</span>(<span class="string">"item_title"</span>);</span><br><span class="line">			<span class="built_in">String</span> title = <span class="string">""</span>;</span><br><span class="line">			<span class="keyword">if</span>(list != <span class="keyword">null</span> &amp;&amp; list.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">				title = list.<span class="literal">get</span>(<span class="number">0</span>);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				title = (<span class="built_in">String</span>) solrDocument.<span class="literal">get</span>(<span class="string">"item_title"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			item.setTitle(title);</span><br><span class="line">			item.setImage((<span class="built_in">String</span>) solrDocument.<span class="literal">get</span>(<span class="string">"item_image"</span>));</span><br><span class="line">			item.setPrice((long) solrDocument.<span class="literal">get</span>(<span class="string">"item_price"</span>));</span><br><span class="line">			item.setSell_point((<span class="built_in">String</span>) solrDocument.<span class="literal">get</span>(<span class="string">"item_sell_point"</span>));</span><br><span class="line">			item.setCategory_name((<span class="built_in">String</span>) solrDocument.<span class="literal">get</span>(<span class="string">"item_category_name"</span>));</span><br><span class="line">			</span><br><span class="line">			itemList.add(item);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		resultList.setItemList(itemList);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// get total item number</span></span><br><span class="line">		resultList.setTotalItemCount(solrDocumentList.getNumFound());</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> resultList;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h1><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">Service</span></span><br><span class="line">public class <span class="type">ServiceSearchImpl</span> implements <span class="type">SearchService</span> &#123;</span><br><span class="line">	</span><br><span class="line">	@<span class="type">Autowired</span></span><br><span class="line">	private <span class="type">SearchDao</span> searchDao;</span><br><span class="line"></span><br><span class="line">	@<span class="type">Override</span></span><br><span class="line">	public <span class="type">SearchResult</span> search(<span class="type">String</span> query, <span class="type">int</span> page, <span class="type">int</span> rows) throws <span class="type">Exception</span> &#123;</span><br><span class="line">		<span class="type">SolrQuery</span> solrQuery = new <span class="type">SolrQuery</span>();</span><br><span class="line">		</span><br><span class="line">		solrQuery.setQuery(query);</span><br><span class="line">		</span><br><span class="line">		solrQuery.setStart((page -<span class="number">1</span>) * rows);</span><br><span class="line">		solrQuery.setRows(rows);</span><br><span class="line">		</span><br><span class="line">		solrQuery.<span class="type">set</span>(<span class="string">"df"</span>, <span class="string">"item_keywords"</span>);</span><br><span class="line">		</span><br><span class="line">		solrQuery.setHighlight(<span class="literal">true</span>);</span><br><span class="line">		solrQuery.addHighlightField(<span class="string">"item_title"</span>);</span><br><span class="line">		solrQuery.setHighlightSimplePre(<span class="string">"&lt;em style=\"color:red\"&gt;"</span>);</span><br><span class="line">		solrQuery.setHighlightSimplePost(<span class="string">"&lt;/em&gt;"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="type">SearchResult</span> <span class="literal">result</span> = searchDao.search(solrQuery);</span><br><span class="line">		</span><br><span class="line">		long totalItemCount = <span class="literal">result</span>.getTotalItemCount();</span><br><span class="line">		long totalPageCount = totalItemCount / rows;</span><br><span class="line">		<span class="keyword">if</span> (totalItemCount % rows &gt; <span class="number">0</span>)&#123;</span><br><span class="line">			totalPageCount++;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="literal">result</span>.setTotalPageCount(totalPageCount);</span><br><span class="line">		<span class="literal">result</span>.setCurrentPageNumber(page);</span><br><span class="line">		<span class="literal">result</span>.setCurrentRowCount(rows);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">result</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h1><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchServiceController</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="annotation">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> SearchService searchService;</span><br><span class="line">	</span><br><span class="line">	<span class="annotation">@RequestMapping</span>(value=<span class="string">"/query"</span>, method=RequestMethod.GET)</span><br><span class="line">	<span class="annotation">@ResponseBody</span></span><br><span class="line">	<span class="keyword">public</span> TaotaoResult search(<span class="annotation">@RequestParam</span>(<span class="string">"q"</span>)String query, </span><br><span class="line">			<span class="annotation">@RequestParam</span>(defaultValue=<span class="string">"1"</span>)Integer page,</span><br><span class="line">			<span class="annotation">@RequestParam</span>(defaultValue=<span class="string">"20"</span>)Integer rows)&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//query is null</span></span><br><span class="line">		<span class="keyword">if</span>(StringUtils.isBlank(query))</span><br><span class="line">			<span class="function"><span class="keyword">return</span> TaotaoResult.<span class="title">build</span><span class="params">(<span class="number">400</span>, <span class="string">"Should contain query string"</span>)</span></span>;</span><br><span class="line">		</span><br><span class="line">		SearchResult searchResult = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			query = <span class="keyword">new</span> String(query.getBytes(<span class="string">"iso8859-1"</span>), <span class="string">"utf-8"</span>);</span><br><span class="line">			searchResult = searchService.search(query, page, rows);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">return</span> TaotaoResult.<span class="title">ok</span><span class="params">(searchResult)</span></span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/javaproject/solr_search_service.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://izheyi.com/2018/07/22/Java项目实战-solr导入索引库/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="唐胡璐">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YONGFEIUALL">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/22/Java项目实战-solr导入索引库/" itemprop="url">Java项目实战 - solr导入索引库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-07-22T17:33:57+08:00">
                2018-07-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
            <!--noindex-->
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/22/Java项目实战-solr导入索引库/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count hc-comment-count" data-xid="2018/07/22/Java项目实战-solr导入索引库/" itemprop="commentsCount"></span>
                </a>
              </span>
              <!--/noindex-->
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>实现：<br>使用java程序读取mysql数据库中的商品信息，然后创建solr文档对象，把商品信息写入索引库。</p>
<h1 id="Dao"><a href="#Dao" class="headerlink" title="Dao"></a>Dao</h1><p>多表查询，要创建相应的POJO和Mapper。<br>POJO:<br><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> class Item &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> id;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> title;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> sell_point;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> price;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> <span class="built_in">image</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> category_name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">String</span> item_des;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Mapper:<br><figure class="highlight capnproto"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">interface</span> <span class="title">ItemMapper</span> </span>&#123;</span><br><span class="line">	<span class="built_in">List</span>&lt;Item&gt; getItemList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>xml<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="doctype">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">mapper</span> <span class="attribute">namespace</span>=<span class="value">"com.izheyi.search.mapper.ItemMapper"</span> &gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="title">select</span> <span class="attribute">id</span>=<span class="value">"getItemList"</span> <span class="attribute">resultType</span>=<span class="value">"com.izheyi.search.pojo.Item"</span>&gt;</span></span><br><span class="line">		SELECT</span><br><span class="line">			a.id,</span><br><span class="line">			a.title,</span><br><span class="line">			a.sell_point,</span><br><span class="line">			a.price,</span><br><span class="line">			a.image,</span><br><span class="line">			b. NAME category_name</span><br><span class="line">		FROM</span><br><span class="line">			tb_item a</span><br><span class="line">		LEFT JOIN tb_item_cat b ON a.cid = b.id</span><br><span class="line">	<span class="tag">&lt;/<span class="title">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h1><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Service</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ItemServiceImpl</span> <span class="keyword">implements</span> <span class="title">ItemService</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="annotation">@Autowired</span></span><br><span class="line">	private ItemMapper itemMapper;</span><br><span class="line">	</span><br><span class="line">	<span class="annotation">@Autowired</span></span><br><span class="line">	private SolrServer solrServer;</span><br><span class="line">	</span><br><span class="line">	<span class="annotation">@Override</span></span><br><span class="line">	public TaotaoResult importItemsToSolr() &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//查询商品列表</span></span><br><span class="line">			<span class="built_in">List</span>&lt;Item&gt; list = itemMapper.getItemList();</span><br><span class="line">			<span class="comment">//把商品信息写入索引库</span></span><br><span class="line">			<span class="keyword">for</span> (Item item : list) &#123;</span><br><span class="line">				<span class="comment">//创建一个SolrInputDocument对象</span></span><br><span class="line">				SolrInputDocument <span class="built_in">document</span> = <span class="keyword">new</span> SolrInputDocument();</span><br><span class="line">				<span class="built_in">document</span>.setField(<span class="string">"id"</span>, item.getId());</span><br><span class="line">				<span class="built_in">document</span>.setField(<span class="string">"item_title"</span>, item.getTitle());</span><br><span class="line">				<span class="built_in">document</span>.setField(<span class="string">"item_sell_point"</span>, item.getSell_point());</span><br><span class="line">				<span class="built_in">document</span>.setField(<span class="string">"item_price"</span>, item.getPrice());</span><br><span class="line">				<span class="built_in">document</span>.setField(<span class="string">"item_image"</span>, item.getImage());</span><br><span class="line">				<span class="built_in">document</span>.setField(<span class="string">"item_category_name"</span>, item.getCategory_name());</span><br><span class="line">				<span class="built_in">document</span>.setField(<span class="string">"item_desc"</span>, item.getItem_des());</span><br><span class="line">				<span class="comment">//写入索引库</span></span><br><span class="line">				solrServer.add(<span class="built_in">document</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//提交修改</span></span><br><span class="line">			solrServer.commit();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			<span class="keyword">return</span> TaotaoResult.build(<span class="number">500</span>, ExceptionUtil.getStackTrace(e));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> TaotaoResult.ok();</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要配置applicationContext-solr.xml。</p>
<h1 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h1><figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">Controller</span></span><br><span class="line">@<span class="type">RequestMapping</span>(<span class="string">"/manager"</span>)</span><br><span class="line">public class <span class="type">ItemController</span> &#123;</span><br><span class="line">	</span><br><span class="line">	@<span class="type">Autowired</span> <span class="type">ItemService</span> itemService;</span><br><span class="line">	</span><br><span class="line">	@<span class="type">RequestMapping</span>(<span class="string">"/import"</span>)</span><br><span class="line">	@<span class="type">ResponseBody</span></span><br><span class="line">	public <span class="type">TaotaoResult</span> importItemsToSolr()&#123;</span><br><span class="line">		<span class="type">TaotaoResult</span> <span class="literal">result</span> = itemService.importItemsToSolr();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">result</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/javaproject/solr_import.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/40/">40</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/uploads/avatar.jpg"
                alt="唐胡璐" />
            
              <p class="site-author-name" itemprop="name">唐胡璐</p>
              <p class="site-description motion-element" itemprop="description">i just wanna live while i am alive</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">393</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">42</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">74</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://www.linkedin.com/in/yongfeiuall" target="_blank" title="LinkedIn">
                      
                        <i class="fa fa-fw fa-linkedin"></i>LinkedIn</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="http://weibo.com/yongfeiuall" target="_blank" title="Weibo">
                      
                        <i class="fa fa-fw fa-weibo"></i>Weibo</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/yongfeiuall" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="yongfeiuall@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          
            <div class="cc-license motion-element" itemprop="license">
              <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
                <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
              </a>
            </div>
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">唐胡璐</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	

		<script type="text/javascript">
		_hcwp = window._hcwp || [];

		_hcwp.push({widget:"Bloggerstream", widget_id: 101212, selector:".hc-comment-count", label: "{\%COUNT%\}" });

		

		(function() {
		if("HC_LOAD_INIT" in window)return;
		HC_LOAD_INIT = true;
		var lang = (navigator.language || navigator.systemLanguage || navigator.userLanguage || "en").substr(0, 2).toLowerCase();
		var hcc = document.createElement("script"); hcc.type = "text/javascript"; hcc.async = true;
		hcc.src = ("https:" == document.location.protocol ? "https" : "http")+"://w.hypercomments.com/widget/hc/101212/"+lang+"/widget.js";
		var s = document.getElementsByTagName("script")[0];
		s.parentNode.insertBefore(hcc, s.nextSibling);
		})();
		</script>

	
















  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">

  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "default";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Wechat,Linkedin,Weibo,Mailto,Douban,QQZone,Twitter,Reddit,Facebook";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
  </script>

  

  

  

  

</body>
</html>
